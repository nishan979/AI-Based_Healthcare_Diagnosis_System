<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="Find easily a doctor and book online an appointment"
    />
    <meta name="author" content="Nishan" />
    <title>
      DocExpress - Find easily a doctor and book online an appointment
    </title>

    <!-- Favicons-->
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon" />
    <link
      rel="apple-touch-icon"
      type="image/x-icon"
      href="img/apple-touch-icon-57x57-precomposed.png"
    />
    <link
      rel="apple-touch-icon"
      type="image/x-icon"
      sizes="72x72"
      href="img/apple-touch-icon-72x72-precomposed.png"
    />
    <link
      rel="apple-touch-icon"
      type="image/x-icon"
      sizes="114x114"
      href="img/apple-touch-icon-114x114-precomposed.png"
    />
    <link
      rel="apple-touch-icon"
      type="image/x-icon"
      sizes="144x144"
      href="img/apple-touch-icon-144x144-precomposed.png"
    />

    <!-- GOOGLE WEB FONT -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <!-- BASE CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <link href="css/style.css" rel="stylesheet" />
    <link href="css/menu.css" rel="stylesheet" />
    <link href="css/vendors.css" rel="stylesheet" />
    <link href="css/icon_fonts/css/all_icons_min.css" rel="stylesheet" />

    <!-- YOUR CUSTOM CSS -->
    <link href="css/custom.css" rel="stylesheet" />
  </head>

  <body>
    <div class="layer"></div>
    <!-- Mobile menu overlay mask -->

    <div id="preloader">
      <div data-loader="circle-side"></div>
    </div>
    <!-- End Preload -->

    <header class="header_sticky">
      <div class="container">
        <div class="row">
          <div class="col-lg-3 col-6">
            <div id="logo_home">
              <h1><a href="index.html" title="Findoctor">DocExpress</a></h1>
            </div>
          </div>
          <nav class="col-lg-9 col-6">
            <a
              class="cmn-toggle-switch cmn-toggle-switch__htx open_close"
              href="#0"
              ><span>Menu mobile</span>
            </a>
            <div class="main-menu">
              <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="grid-list.html">Doctors</a></li>
                <li><a href="detail-page.html">Appointment</a></li>
                <li><a href="about.html">About Us</a></li>
                <li><a href="contacts.html">Contacts</a></li>
                <li><a href="login.html">Login</a></li>
                <li><a href="register.html">Sign Up</a></li>
              </ul>
            </div>
            <!-- /main-menu -->
          </nav>
        </div>
      </div>
      <!-- /container -->
    </header>
    <!-- /header -->

    <main>
      <div class="bg_color_2">
        <div class="container margin_60_35">
          <div id="login-2">
            <h1>Please login to DocExpress!</h1>
            <!-- Change the form to this -->
            <form id="loginForm">
              <div class="box_form clearfix">
                <div class="box_login">
                  <a href="/auth/facebook" class="social_bt facebook"
                    >Login with Facebook</a
                  >
                  <a href="/auth/google" class="social_bt google"
                    >Login with Google</a
                  >
                  <a href="/auth/linkedin" class="social_bt linkedin"
                    >Login with Linkedin</a
                  >
                </div>
                <div class="box_login last">
                  <div class="form-group">
                    <input
                      type="email"
                      class="form-control"
                      placeholder="Your email address"
                      id="loginEmail"
                      required
                    />
                  </div>
                  <div class="form-group">
                    <select class="form-control" id="loginRole" required>
                      <option value="">-- Select Role --</option>
                      <option value="patient">Patient</option>
                      <option value="doctor">Doctor</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <input
                      type="password"
                      class="form-control"
                      placeholder="Your password"
                      id="loginPassword"
                      required
                    />
                    <a href="contacts.html" class="forgot"
                      ><small>Forgot password?</small></a
                    >
                  </div>
                  <div class="form-group">
                    <input class="btn_1" type="submit" value="Login" />
                  </div>
                </div>
              </div>
            </form>
            <p class="text-center link_bright">
              Do not have an account yet?
              <a href="register.html"><strong>Register now!</strong></a>
            </p>
          </div>
          <!-- /login -->
        </div>
      </div>
    </main>
    <!-- /main -->

    <footer>
      <div class="container margin_60_35">
        <div class="row">
          <div class="col-lg-3 col-md-12">
            <p>
              <a href="index.html" title="Findoctor">
                <img
                  src="img/logo.png"
                  alt=""
                  width="163"
                  height="36"
                  class="img-fluid"
                />
              </a>
            </p>
          </div>
          <div class="col-lg-3 col-md-4">
            <h5>About</h5>
            <ul class="links">
              <li><a href="about.html">About us</a></li>
              <li><a href="faq.html">FAQ</a></li>
              <li><a href="login.html">Login</a></li>
              <li><a href="register.html">Register</a></li>
            </ul>
          </div>
          <div class="col-lg-3 col-md-4">
            <h5>Useful links</h5>
            <ul class="links">
              <li><a href="grid-list.html">Doctors</a></li>
              <li><a href="grid-list.html">Specialization</a></li>
              <li><a href="register-doctor.html">Join as a Doctor</a></li>
            </ul>
          </div>
          <div class="col-lg-3 col-md-4">
            <h5>Contact with Us</h5>
            <ul class="contacts">
              <li>
                <a href="tel://1634664389"
                  ><i class="icon_mobile"></i> + 880 16346 64389</a
                >
              </li>
              <li>
                <a href="mailto:help@docexpress.com"
                  ><i class="icon_mail_alt"></i> help@DocExpress.com</a
                >
              </li>
            </ul>
            <div class="follow_us">
              <h5>Follow us</h5>
              <ul>
                <li>
                  <a href="https://www.facebook.com/"><i class="bi bi-facebook"></i></a>
                </li>
                <li>
                  <a href="https://x.com/"><i class="bi bi-twitter-x"></i></a>
                </li>
                <li>
                  <a href="https://www.instagram.com/"><i class="bi bi-instagram"></i></a>
                </li>
                <li>
                  <a href="https://www.tiktok.com/"><i class="bi bi-tiktok"></i></a>
                </li>
                <li>
                  <a href="https://www.whatsapp.com/"><i class="bi bi-whatsapp"></i></a>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <!--/row-->
        <hr />
        <div class="row">
          <div class="col-md-8">
            <ul id="additional_links">
              <li><a href="terms.html">Terms and conditions</a></li>
              <li><a href="privacy.html">Privacy</a></li>
            </ul>
          </div>
          <div class="col-md-4">
            <div id="copy">Â© 2025 DocExpress</div>
          </div>
        </div>
      </div>
    </footer>
    <!--/footer-->

    <div id="toTop"></div>
    <!-- Back to top button -->

    <!-- COMMON SCRIPTS -->
    <script src="js/jquery-3.7.1.min.js"></script>
    <script src="js/common_scripts.min.js"></script>
    <script src="js/functions.js"></script>
    <script>
      document
        .getElementById("loginForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const email = document.getElementById("loginEmail").value.trim();
          const password = document.getElementById("loginPassword").value;

          try {
            const response = await fetch("/login", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ email, password }),
            });

            // Check if response is JSON
            const contentType = response.headers.get("content-type");
            if (!contentType?.includes("application/json")) {
              const text = await response.text();
              throw new Error(`Server error: ${text.slice(0, 50)}`);
            }

            const data = await response.json();

            if (data.success) {
              // Store user data and redirect
              localStorage.setItem("currentUser", JSON.stringify(data.user));
              window.location.href = data.redirect;
            } else {
              throw new Error(data.error || "Login failed");
            }
          } catch (error) {
            console.error("Login error:", error);
            alert(error.message.replace(/<\/?[^>]+(>|$)/g, "")); // Sanitize HTML
            document.getElementById("loginPassword").value = "";
          }
        });
    </script>
  </body>
</html>
